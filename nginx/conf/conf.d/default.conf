server {
    listen 80;
    listen [::]:80;
    server_name m.lyloou.com;
    server_tokens off;

    location ^~ /.well-known/acme-challenge/ {
        default_type "text/plain";
        allow all;
        root /usr/share/certbot/www/;
    }

   # location / {
   #     return 301 https://m.lyloou.com$request_uri;
   # }
  location / {
    proxy_pass http://172.18.0.1:5230;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}

server {
      listen       443 ssl;
      server_name  m.lyloou.com;
      #日志
      #证书信息，这里的路径是nginx容器内的
      ssl_certificate /usr/share/certbot/ssl/live/m.lyloou.com/fullchain.pem;
      ssl_certificate_key /usr/share/certbot/ssl/live/m.lyloou.com/privkey.pem;
      ssl_session_timeout 5m;
      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
      ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
      ssl_prefer_server_ciphers on;

      location / {
        proxy_pass http://172.18.0.1:5230;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
}
server {
    listen 80;
    server_name flow.lyloou.com;
    location / {
        proxy_pass http://172.18.0.1:5230;
    }
}
server {
    listen 80;
    server_name love.lyloou.com;
    location / {
        proxy_pass http://172.18.0.1:9121;
    }
}
server {
    listen 80;
    server_name admin.lyloou.com;
    location / {
        proxy_pass http://172.18.0.1:9000;
    }
    location /momo/ {
        proxy_pass http://172.18.0.1:8001/;
    }
    location /alist/ {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Range $http_range;
        proxy_set_header If-Range $http_if_range;
        proxy_redirect off;
        proxy_pass http://172.18.0.1:5244/alist/;
        # the max size of file to upload
        client_max_body_size 20000m;
    }
}
server {
    listen 80;
    listen 443 ssl http2;
    server_name fund.lyloou.com;
    ssl_certificate     /cert/server.crt;
    ssl_certificate_key  /cert/server.key;
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    location / {
         root /fund;
         autoindex on; # 索引 
         autoindex_exact_size on; # 显示文件大小 
         autoindex_localtime on; # 显示文件时间 

    }
}
server {
    listen 80;
    server_name f.lyloou.com;

    location / {
         root /fund2;
         default_type image/jpeg;
         autoindex on; # 索引 
         #autoindex_exact_size on; # 显示文件大小 
         #autoindex_localtime on; # 显示文件时间 
         #add_header Content-Type text/plain;
    }
}
server {
    listen       80;
    server_name  christmas.lyloou.com;

    #charset koi8-r;
    #access_log  /var/log/nginx/host.access.log  main;

    location /c/ {
        root   /usr/share/nginx/html/Christmas;
        index  index.html index.htm;
    }
    location / {
         root   /usr/share/nginx/html/Christmas;
         #root   /usr/share/nginx/html/pp;
         charset utf-8;
         autoindex on; # 索引 
         autoindex_exact_size on; # 显示文件大小 
         autoindex_localtime on; # 显示文件时间 
    }

    location /docker {
        proxy_pass http://172.18.0.1:4000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }


    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
server {
    listen 80;
    server_name box-admin.lyloou.com;
     # To allow special characters in headers
        ignore_invalid_headers off;
        # Allow any size file to be uploaded.
        # Set to a value such as 1000m; to restrict file size to a specific value
        client_max_body_size 0;
        # To disable buffering
        proxy_buffering off;
        proxy_request_buffering off;

    location / {
            proxy_pass http://172.18.0.1:9010;

            proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header X-NginX-Proxy true;

            # This is necessary to pass the correct IP to be hashed
            real_ip_header X-Real-IP;

            proxy_connect_timeout 300;

            # To support websocket
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";

            chunked_transfer_encoding off;

    }
}
server {
    listen 80;
    server_name box-api.lyloou.com;
    # To allow special characters in headers
        ignore_invalid_headers off;
        # Allow any size file to be uploaded.
        # Set to a value such as 1000m; to restrict file size to a specific value
        client_max_body_size 0;
        # To disable buffering
        proxy_buffering off;
        proxy_request_buffering off;
    location / {
        proxy_pass http://172.18.0.1:9009;

        proxy_set_header Host $http_host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_connect_timeout 300;
            # Default is HTTP/1, keepalive is only enabled in HTTP/1.1
            proxy_http_version 1.1;
            proxy_set_header Connection "";
            chunked_transfer_encoding off;
    }
}
